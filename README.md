
# CBT-FX: It just works
This is my attempt at writing a sound effect driver that's natively compatible with [GBDK-2020](https://github.com/gbdk-2020/gbdk-2020/) (Instead of having to use register values or converting other assembly drivers to GBDK-2020), made to be used with the [FX Hammer editor](https://www.pouet.net/prod.php?which=17337). It's aimed at people who want good sounding sound effects but don't wanna have to do custom solutions, feel free to use the translated example SFX's too (see [here](https://github.com/datguywitha3ds/CBT-FX/blob/main/include/sfx)).

# Usage
 1. Copy `cbtfx.h` and `cbtfx.c` from the `include` folder and `hammer2cbt.py` to your source.
 2. Create your sound effects first in the before mentioned [FX Hammer editor](https://www.pouet.net/prod.php?which=17337).
 3. Copy your .sav file generated by the editor (normally called `hammered.sav`) to your source directory
 4. Use the `hammer2cbt.py` script to convert your desired effects, it takes a few necessary arguments:
 ```
 usage: hammer2cbt.py [-h] [-i INPUT] [-o OUTPUT] [-b BANK] [-dp DPATH]
                     [-na NAME] [-nu NUMBER] [-lr INVERT]

optional arguments:
  -h, --help            show this help message and exit
  -i INPUT, --input INPUT
                        Input FX Hammer .sav file
  -o OUTPUT, --output OUTPUT
                        Output folder for .c/.h files
  -b BANK, --bank BANK  Optional bank number
  -dp DPATH, --dpath DPATH
                        Optional path to CBT-FX (F.E '-dp include/cbtfx.h', default is 'cbtfx.h')
  -na NAME, --name NAME
                        Optional effect name (Default is 'SFX_' Followed by
                        the effect number)
  -nu NUMBER, --number NUMBER
                        Effect number to export
  -lr INVERT, --invert INVERT
                        Invert FX Hammer pan values (Editor is inverted)
example:
    python3 hammer2cbt.py --input hammered.sav --output sfx_folder
```
 5. Include the generated .h files into your desired .c files.
 6. Add a call to `CBTFX_update` in your main loop so it gets called every frame, or add it as a VBL interrupt (Recommended to avoid stutter).
 7. When you need to play a sound effect, call `CBTFX_init(&your_SFX_name[0][0], your_SFX_name_Length)` (There's also a macro generated called `CBTFX_PLAY_your_SFX_name` that should do the same thing.).

This repository comes with an example project and all the sound effects from FX Hammer converted (See `src`).

# For music driver users
If you're already using a driver for music such as [hUGEdriver](https://github.com/SuperDisk/hUGEDriver), [GBT Player](https://github.com/AntonioND/gbt-player/tree/master/legacy_gbdk) or any other, you will need to add a few lines of code to the CBTFX functions to make it play ball with this.
There's 4 macros in `cbtfx.c` that should be set to your music driver's mute functions, the before mentioned drivers have a single function that toggles channels, in that case you should set them like: 
```c
// For hUGEdriver
#define MUSIC_DRIVER_CH2_ON hUGE_mute_channel(HT_CH2, 0);
#define MUSIC_DRIVER_CH2_OFF hUGE_mute_channel(HT_CH2, 1);
#define MUSIC_DRIVER_CH4_ON hUGE_mute_channel(HT_CH4, 0);
#define MUSIC_DRIVER_CH4_OFF hUGE_mute_channel(HT_CH4, 1);

// For GBT Player
#define MUSIC_DRIVER_CH2_ON gbt_enable_channels(GBT_CHAN_2);
#define MUSIC_DRIVER_CH2_OFF gbt_enable_channels(GBT_CHAN_2);
#define MUSIC_DRIVER_CH4_ON gbt_enable_channels(GBT_CHAN_4);
#define MUSIC_DRIVER_CH4_OFF gbt_enable_channels(GBT_CHAN_4);
```

ALSO remember to update CBTFX **after** your music driver, to avoid the music driver going over the sound effects.

# Pros of this "driver"
- Works with GBDK-2020 out of the box.
- Player is tiny in size
- SFX's are 1:1 to FX Hammer's playback.
# Cons
- Sound effects tend to be a little on the chunky side, if you're working on a big game, I'd recommend keeping the sound effects in a different bank and add some bank switching lines in the CBTFX functions.
- Only one sfx at a time.
